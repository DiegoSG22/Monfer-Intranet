{% extends 'odontologia/base.html' %}

{% block extra_head %}
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
<style>
    .fc-toolbar-title { font-size: 1.5rem; font-weight: 700; text-transform: capitalize; }
    .fc-button-primary { background-color: #e83e8c !important; border-color: #e83e8c !important; border-radius: 10px; }
    .fc-day-today { background-color: rgba(232, 62, 140, 0.08) !important; }
    .fc-event { cursor: pointer; border: none; padding: 4px; border-radius: 6px; }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="h4 fw-bold text-primary"><i class="fas fa-calendar-day me-2"></i>Agenda de Atenciones</h2>
        <p class="text-muted m-0">Gestiona todas las citas programadas.</p>
    </div>
    {% if not es_admin %}
        <a href="{% url 'registrar_atencion' %}" target="_blank" class="btn btn-success shadow-sm px-4 rounded-pill"><i class="fas fa-plus me-2"></i> Registrar Nueva Atencion</a>
    {% endif %}
</div>

<div class="card shadow p-3">
    <div id='calendar'></div>
</div>
{% endblock %}

{% block extra_script %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var eventos = JSON.parse('{{ atenciones_json|safe }}');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'es',
            headerToolbar: { left: 'prev,next today', center: 'title', right: 'dayGridMonth,timeGridWeek,timeGridDay' },
            buttonText: { today: 'Hoy', month: 'Mes', week: 'Semana', day: 'DÃ­a' },
            events: eventos,
            eventColor: '#e83e8c',
            eventClick: function(info) { window.location.href = '/atencion/' + info.event.id + '/'; },
            height: 'auto',
            contentHeight: 750
        });
        calendar.render();
    });
</script>
{% endblock %}